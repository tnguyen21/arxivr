{% extends "shared/base.html" %}

{% block content %}
    <title>ArXiv Papers</title>
    <h1>Recent ArXiv Papers</h1>
    <ul>
    {% for paper in papers %}
      <li>
        <h3><a href="{{ paper.abstract_link }}">{{ paper.title }}</a></h3>
        <p class="paper-metadata">
          <span aria-label="Published date" style="font-style: italic">{{ paper.published }}</span>
          <span aria-label="Paper category" style="font-weight: bold">{{ paper.category }}</span>
          <a href="#" class="save-paper-link" data-paper-id="{{ paper.id }}" onclick="savePaper('{{ paper.id }}')" aria-label="Save {{ paper.title }} to my papers">Save Paper</a>
          <br>
          <span aria-label="Authors">{{ paper.author }}</span>
        </p>
        <p>{{ paper.summary }}</p>
        <script>
        async function savePaper(paperId) {
            const userId = localStorage.getItem('user_id');
            if (!userId) {
                window.location.href = '/login';
                return;
            }
            
            const response = await fetch('/papers/save', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_id: userId,
                    paper_id: paperId
                })
            });

            if (response.ok) {
                alert('Paper saved successfully');
            } else {
                alert('Error saving paper');
            }
        }
        </script>
      </li>
    {% endfor %}
    </ul>
{% endblock %}
